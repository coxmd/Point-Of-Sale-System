function ReloadPage() {
    GetAllBranches();
    $("#report").trigger("change")
}
function GetAllBranches() {
    var n = $("#BranchID");
    n.empty();
    GetOrPostAsync("GET", "/Configurations/GetAllBranches/", "", "").then(t => {
        var i, r;
        if (!$.isEmptyObject(t))
            for (t.length > 1 ? n.append("<option><\/option>") : onlyOneBranch = !0,
                i = 0; i < t.length; i++)
                r = `<option value="${t[i].companyBranchID}">${t[i].name}</option>`,
                    n.append(r)
    }
    ).catch(n => Notify(!1, n))
}
function GetAllStorageLocations() {
    var i = $("#BranchID").val(), t = $("#StorageLocationID"), n;
    t.empty();
    t.append("<option><\/option>");
    n = $("#ReqStorageLocationID");
    n.empty();
    n.append("<option><\/option>");
    GetOrPostAsync("POST", "/Configurations/GetAllStorageLocationsByBranchID/", i, "").then(i => {
        var r, u, f;
        if (!$.isEmptyObject(i))
            for (r = 0; r < i.length; r++)
                u = `<option value="${i[r].storageLocationID}">${i[r].name}</option>`,
                    t.append(u),
                    f = `<option value="${i[r].storageLocationID}">${i[r].name}</option>`,
                    n.append(f)
    }
    ).catch(n => Notify(!1, n))
}
function GetItemsByLocation() {
    var t = $("#StorageLocationID").val()
        , i = $("#ReportsForm input[name=__RequestVerificationToken]").val()
        , n = $("#ItemID");
    n.empty();
    n.append("<option><\/option>");
    GetOrPostAsync("POST", "/Configurations/GetInventoryItemsByStorageLocationIDDetails/", t, i).then(t => {
        if (!$.isEmptyObject(t)) {
            for (var i = 0; i < t.length; i++) {
                let r = new Option(t[i].name, t[i].itemID);
                n.append(r)
            }
            n.select2()
        }
    }
    ).catch(n => Notify(!1, n))
}
function ResetAllChooseForms() {
    let n = $('form[id^="Choose"');
    for (let t = 0; t < n.length; t++)
        n[t].reset()
}
function HandleCustomReportParameters() {
    ResetAllChooseForms();
    let i = $("#report").find(":selected").data("params") || ""
        , n = i.split(",")
        , t = !1;
    for (let i = 0; i < n.length; i++) {
        let r = n[i];
        if (!isEmpty(r))
            switch (Number(r)) {
                case 1:
                    t = !0;
                    break;
                case 91:
                    requiresLocation = !0;
                    break;
                case 92:
                    requiresItem = !0
            }
    }
    t && $(".select-branch-modal").modal("toggle")
}
function GenerateCustomReport(n, t) {
    let r = $("#report").find(":selected").data("id")
        , u = $("#BranchID").val() || 0
        , i = "";
    isEmpty($("#StorageLocationID").val()) || (i += `${$("#StorageLocationID").val()},`);
    isEmpty($("#ItemID").val()) || (i += `${$("#ItemID").val()},`);
    $("#DashboardReportIframe").attr("src", `/Dashboard/RenderCustomReport/?reportID=${r}&branchID=${u}&dateFrom=${n}&dateTo=${t}&otherParams=${i}`)
}
$(document).ready(function () {
    $("#dateFrom").val((new Date).toLocalISOString().slice(0, 10));
    $("#dateTo").val((new Date).toLocalISOString().slice(0, 10));
    $("#report").select2({
        placeholder: "Select Report",
        width: "resolve"
    });
    ReloadPage()
});
var requiresLocation = !1
    , requiresReqLocation = !1
    , requiresItem = !1
    , onlyOneBranch = !1;
$("#report").on("change", () => {
    var n = Number($("#report").val());
    if ($("#customBreadCrumb").empty(),
        !isNaN(n))
        switch (n) {
            case -1:
                HandleCustomReportParameters();
                break;
            case 2:
                $(".select-branch-modal").modal("toggle");
                break;
            case 3:
                requiresLocation = !0;
                $(".select-branch-modal").modal("toggle");
                break;
            case 4:
                requiresLocation = !0;
                $(".select-branch-modal").modal("toggle");
                break;
            case 5:
                requiresLocation = !0;
                $(".select-branch-modal").modal("toggle");
                break;
            case 6:
                $(".select-branch-modal").modal("toggle");
                break;
            case 7:
                requiresLocation = !0;
                $(".select-branch-modal").modal("toggle");
                break;
            case 8:
                $(".select-branch-modal").modal("toggle");
                requiresLocation = !0;
                break;
            case 9:
                $(".select-branch-modal").modal("toggle");
                requiresLocation = !0;
                break;
            case 10:
                $(".select-branch-modal").modal("toggle");
                requiresLocation = !0;
                break;
            case 11:
                $(".select-branch-modal").modal("toggle");
                requiresLocation = !0;
                requiresReqLocation = !0;
                break;
            case 12:
                $(".select-branch-modal").modal("toggle");
                requiresLocation = !0;
                break;
            case 13:
                $(".select-branch-modal").modal("toggle");
                break;
            case 14:
                $(".select-branch-modal").modal("toggle");
                break;
            case 15:
                $(".select-branch-modal").modal("toggle");
                requiresLocation = !0;
                break;
            case 16:
                $(".select-branch-modal").modal("toggle");
                requiresLocation = !0;
                requiresItem = !0;
                break;
            case 17:
                $(".select-branch-modal").modal("toggle");
                requiresLocation = !0;
                break;
            case 18:
                $(".select-branch-modal").modal("toggle");
                requiresLocation = !0;
                break;
            case 19:
                $(".select-branch-modal").modal("toggle");
                requiresLocation = !0;
                break;
            case 20:
                $(".select-branch-modal").modal("toggle");
                requiresLocation = !0
        }
}
);
$("#ReportsForm").submit(function (event) {
    event.preventDefault();

    var dashboardReportData = {
        ReportID: Number($("#report").val()),
        DateFrom: $("#dateFrom").val(),
        DateTo: $("#dateTo").val()
    };
    var requestVerificationToken = $("#ReportsForm input[name=__RequestVerificationToken]").val();

    AjaxServerCallAsync("POST", "/Dashboard/GetInventoryReportPath/", dashboardReportData, requestVerificationToken, function (response) {
        var responseData = response.response.reportUrl;

        if (response.status) {
            $("#DashboardReportIframe").attr("src", responseData);
        } else {
            Notify(false, responseData);
        }
    });
});

$(".select-branch-modal").on("shown.bs.modal", function () {
    onlyOneBranch && $("#ChooseBranchForm").submit()
});
$("#ChooseBranchForm").submit(n => {
    n.preventDefault(),
        GetAllStorageLocations(),
        $(".select-branch-modal").modal("toggle"),
        requiresLocation && ($(".select-location-modal").modal("toggle"),
            requiresLocation = !1),
        $("#customBreadCrumb").append(`<li><a href="Javascript:ReloadPage()">${$("#BranchID option:selected").text()}</a></li>`)
}
);
$("#ChooseLocationForm").submit(n => {
    n.preventDefault(),
        $(".select-location-modal").modal("toggle"),
        requiresReqLocation && ($(".select-reqlocation-modal").modal("toggle"),
            requiresReqLocation = !1),
        requiresItem && (GetItemsByLocation(),
            $(".select-item-modal").modal("toggle"),
            requiresItem = !1),
        $("#customBreadCrumb").append(`<li><a href="Javascript:ReloadPage()">${$("#StorageLocationID option:selected").text()}</a></li>`)
}
);
$("#ChooseReqLocationForm").submit(n => {
    n.preventDefault(),
        $(".select-reqlocation-modal").modal("toggle"),
        $("#customBreadCrumb").append(`<li><a href="Javascript:ReloadPage()">${$("#ReqStorageLocationID option:selected").text()}</a></li>`)
}
);
$("#ChooseItemForm").submit(n => {
    n.preventDefault(),
        $(".select-item-modal").modal("toggle"),
        $("#customBreadCrumb").append(`<li><a href="Javascript:ReloadPage()">${$("#ItemID option:selected").text()}</a></li>`)
}
);
$(".btnClose").on("click", function () {
    $("#ReportsForm")[0].reset();
    $("#dateFrom").val((new Date).toLocalISOString().slice(0, 10));
    $("#dateTo").val((new Date).toLocalISOString().slice(0, 10));
    requiresLocation = !1;
    requiresReqLocation = !1;
    requiresItem = !1;
    $("#customBreadCrumb").empty();
    $(".modal").modal("hide");
    $("#report").select2({
        placeholder: "Select Report",
        width: "resolve"
    })
});
